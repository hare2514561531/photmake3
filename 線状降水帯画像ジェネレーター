
<html lang="ja">
<head>
<meta charset="UTF-8"></meta>
<meta content="width=device-width, initial-scale=1" name="viewport"></meta>
<title>線状降水帯画像ジェネレーター (B4 14:9)</title>
<style>
  body {
    background-color: #eef2f7;
    font-family: 'Helvetica Neue', sans-serif;
    text-align: center;
    padding: 10px;
  }
  input, button {
    padding: 10px;
    margin: 5px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 90%;
    max-width: 400px;
  }
  button {
    background-color: #303f9f;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #1a237e;
  }
  canvas {
    margin-top: 15px;
    border-radius: 15px;
    width: 100%;
    max-width: 700px;
    height: auto;
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
  }

  /* 🆕 リニューアルした共有ボタン */
  button.share-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background-color: #00897b;
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    padding: 14px 26px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }
  button.share-btn:hover {
    background-color: #00695c;
    transform: translateY(-2px);
  }
  button.share-btn svg {
    width: 22px;
    height: 22px;
    fill: currentColor;
  }
</style>
</head>
<body>

<h2>🌧️ 線状降水帯画像作成 </h2>

<div id="cityList">
  <input class="cityInput" placeholder="市区町村名 (例: 市)" type="text" />
</div>

<button onclick="addCity()">＋ 市町村を追加</button>
<br />
<button onclick="drawImage()">画像生成</button>
<button onclick="downloadImage()">💾 保存</button>

<!-- 🆕 リニューアル共有ボタン -->
<button aria-label="画像を共有" class="share-btn" onclick="shareImage()">
  画像を共有
</button>

<br />
<canvas height="900" id="canvas" width="1400"></canvas>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const CANVAS_WIDTH = 1400;
  const CANVAS_HEIGHT = 900;

  function addCity() {
    const cityList = document.getElementById("cityList");
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "市区町村名";
    input.classList.add("cityInput");
    cityList.appendChild(input);
  }

  function drawImage() {
    const cities = Array.from(document.querySelectorAll(".cityInput"))
      .map(input => input.value.trim())
      .filter(c => c !== "");

    const gradient = ctx.createLinearGradient(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    gradient.addColorStop(0, "#0d47a1");
    gradient.addColorStop(0.5, "#3949ab");
    gradient.addColorStop(1, "#512da8");
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.font = "bold 100px 'Noto Sans JP', sans-serif";
    ctx.shadowColor = "rgba(0,0,0,0.6)";
    ctx.shadowBlur = 10;
    ctx.shadowOffsetX = 4;
    ctx.shadowOffsetY = 4;
    ctx.fillText("線状降水帯発生情報", CANVAS_WIDTH / 2, 120);

    ctx.shadowColor = "transparent";
    ctx.font = "bold 48px 'Noto Sans JP', sans-serif"; // 👈 サイズ調整済み
    ctx.fillText("周囲の状況を確認し早めの避難を!", CANVAS_WIDTH / 2, 180);

    const lineUnderY = 230;
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 7;
    ctx.beginPath();
    ctx.moveTo(0, lineUnderY);
    ctx.lineTo(CANVAS_WIDTH, lineUnderY);
    ctx.stroke();

    const marginSide = 40;
    const boxX = marginSide;
    const boxY = lineUnderY + 30;
    const boxW = CANVAS_WIDTH - marginSide * 2;
    const padding = 30;
    const lineHeight = 80;
    const spaceBetween = 35;

    ctx.font = "bold 50px 'Noto Sans JP', sans-serif";
    ctx.textAlign = "left";

    let lines = [];
    let currentLine = [];
    let currentWidth = 0;

    cities.forEach(city => {
      const textWidth = ctx.measureText(city).width;
      const cityWidth = textWidth + spaceBetween;
      if (currentWidth + cityWidth > boxW - padding * 2 && currentLine.length > 0) {
        lines.push(currentLine);
        currentLine = [city];
        currentWidth = cityWidth;
      } else {
        currentLine.push(city);
        currentWidth += cityWidth;
      }
    });
    if (currentLine.length > 0) lines.push(currentLine);

    const boxH = (lines.length - 1) * lineHeight + 50 + padding * 2;
    ctx.fillStyle = "rgba(255, 255, 255, 0.92)";
    roundRect(ctx, boxX, boxY, boxW, boxH, 35, true, false);

    ctx.fillStyle = "#000";
    lines.forEach((line, rowIndex) => {
      let x = boxX + padding;
      let y = boxY + padding + 50 + (rowIndex * lineHeight);
      line.forEach(city => {
        ctx.fillText(city, x, y);
        x += ctx.measureText(city).width + spaceBetween;
      });
    });

    ctx.fillStyle = "white";
    ctx.font = "28px 'Noto Sans JP', sans-serif";
    ctx.textAlign = "left";
    ctx.fillText("画像制作: EWC 画像制作部", 15, CANVAS_HEIGHT - 20);
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke) {
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.lineTo(x + w - r, y);
    ctx.quadraticCurveTo(x + w, y, x + w, y + r);
    ctx.lineTo(x + w, y + h - r);
    ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
    ctx.lineTo(x + r, y + h);
    ctx.quadraticCurveTo(x, y + h, x, y + h - r);
    ctx.lineTo(x, y + r);
    ctx.quadraticCurveTo(x, y, x + r, y);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) ctx.stroke();
  }

  function downloadImage() {
    const link = document.createElement("a");
    link.download = "linear_rainband_alert_b4.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
    alert("画像をダウンロードしました。\nスマホの場合は画像を長押ししてカメラロールに保存してください。");
  }

  function shareImage() {
    canvas.toBlob(blob => {
      const file = new File([blob], "linear_rainband_alert_b4.png", { type: "image/png" });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        navigator.share({
          files: [file],
          title: "線状降水帯発生情報",
          text: "周囲の状況を確認し、早めの避難を。",
        });
      } else {
        alert("共有機能がこの端末で利用できません。画像を保存して共有してください。");
      }
    });
  }

  window.onload = drawImage;
</script>

</body>
</html>
